@page
@model IndexModel
@{
    ViewData["Title"] = "Home";
}

<div class="dxo-container">
    <!--Telling the user to configure models first * -->
    <section class="collapsible-section" id="modelonfigSection">
        <div class="collapsible-header" onclick="toggleSection('modelonfigSection')">
            <h3>üõ†Ô∏è 1. <a href="/Settings">Configure your Models</a></h3>
        </div>
    </section><br />
    <!-- Agent Configurations (Collapsible, Collapsed by Default) -->
    <section class="collapsible-section collapsed" id="agentConfigSection">
        <div class="collapsible-header" onclick="toggleSection('agentConfigSection')">
            <h3>‚öôÔ∏è 2. Set up your Agent Council</h3>
            <div class="collapsible-chevron">
                <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M3 4.5L6 7.5L9 4.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                        stroke-linejoin="round" />
                </svg>
            </div>
        </div>
        <div class="collapsible-content">
            <div class="agent-configs">
                <div class="persona-cards" id="personaCards">
                    <!-- Creator Card -->
                    <div class="persona-card creator collapsed" data-agent-type="creator">
                        <div class="card-header" onclick="togglePersonaCard(this)">
                            <h3>üé® Creator</h3>
                            <div class="card-header-actions">
                                <select id="creatorModel" class="model-select-header" onclick="event.stopPropagation()"></select>
                                <span class="btn-delete-spacer"></span>
                                <button id="btnResetCreator" class="btn btn-small btn-secondary"
                                    onclick="event.stopPropagation()">Reset Memory</button>
                                <div class="collapsible-chevron">
                                    <svg width="12" height="12" viewBox="0 0 12 12" fill="none"
                                        xmlns="http://www.w3.org/2000/svg">
                                        <path d="M3 4.5L6 7.5L9 4.5" stroke="currentColor" stroke-width="1.5"
                                            stroke-linecap="round" stroke-linejoin="round" />
                                    </svg>
                                </div>
                            </div>
                        </div>

                        <div class="card-body">
                            <details class="seed-prompt-section">
                                <summary>Prompt</summary>
                                <textarea id="creatorPrompt" rows="6"
                                    placeholder="Enter Creator seed prompt..."></textarea>
                            </details>

                            <details class="advanced-settings">
                                <summary>Advanced Settings</summary>
                                <div class="settings-grid">
                                    <div class="setting-group">
                                        <label for="creatorTemp">Temperature</label>
                                        <input type="number" id="creatorTemp" value="0.7" min="0" max="2" step="0.1" />
                                    </div>
                                    <div class="setting-group">
                                        <label for="creatorMaxTokens">Max Tokens</label>
                                        <input type="number" id="creatorMaxTokens" value="4096" min="1" max="128000" />
                                    </div>
                                    <div class="setting-group">
                                        <label for="creatorTopP">Top P</label>
                                        <input type="number" id="creatorTopP" value="1.0" min="0" max="1" step="0.1" />
                                    </div>
                                    <div class="setting-group">
                                        <label for="creatorPresencePenalty">Presence Penalty</label>
                                        <input type="number" id="creatorPresencePenalty" value="0" min="-2" max="2"
                                            step="0.1" />
                                    </div>
                                    <div class="setting-group">
                                        <label for="creatorFrequencyPenalty">Frequency Penalty</label>
                                        <input type="number" id="creatorFrequencyPenalty" value="0" min="-2" max="2"
                                            step="0.1" />
                                    </div>
                                </div>
                            </details>
                        </div>
                    </div>
                </div>
<div><br /><bold>Configure your reviewers here:</bold></div>
<br />
                <!-- Dynamic Reviewer Cards Container -->
                <div id="reviewerCardsContainer">
                    <!-- Reviewer cards will be dynamically added here -->
                </div>
            </div>

            <!-- Add Reviewer Button -->
            <div class="add-reviewer-container">
                <button id="btnAddReviewer" class="btn btn-secondary btn-add-reviewer">
                    <span class="add-icon">+</span> Add a Reviewer
                </button>
            </div>
        </div>
</div>
</section>
<br />
<!-- Central Topic Section (Primary Focus) -->
<section class="topic-section">
    <div class="topic-header">
        <h3>üìå 3. Tell the Council what you'd like their help with</h3>
        @* <span class="topic-hint"></span> *@
    </div>
    <div class="topic-body">
        <textarea id="sessionTopic" rows="4"
            placeholder="Tell us about the topic you'd like the agents to debate over. Example: Write a comprehensive analysis of the best position to place buttons in a mobile UX layout."></textarea>
    </div>
</section>
<br />
<!-- Status Bar -->
<section class="status-bar">
    <!-- Action Buttons -->
    <section class="action-section">
        <button id="btnStart" class="btn btn-primary">‚ñ∂ Start</button>
        <button id="btnStep" class="btn btn-secondary">‚è≠ Step Once</button>
        <button id="btnStop" class="btn btn-danger" disabled>‚èπ Stop</button>
        <button id="btnSessionSettings" class="btn-gear" title="Session Settings">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M10 12.5C11.3807 12.5 12.5 11.3807 12.5 10C12.5 8.61929 11.3807 7.5 10 7.5C8.61929 7.5 7.5 8.61929 7.5 10C7.5 11.3807 8.61929 12.5 10 12.5Z"
                    stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                <path
                    d="M16.1667 12.5C16.0557 12.7513 16.0228 13.0301 16.0722 13.3006C16.1216 13.5711 16.2511 13.8203 16.4417 14.0167L16.4917 14.0667C16.643 14.2177 16.7627 14.3968 16.8443 14.5937C16.9258 14.7906 16.9676 15.0015 16.9676 15.2146C16.9676 15.4276 16.9258 15.6385 16.8443 15.8354C16.7627 16.0323 16.643 16.2114 16.4917 16.3625C16.3406 16.5138 16.1615 16.6335 15.9646 16.7151C15.7677 16.7966 15.5568 16.8384 15.3438 16.8384C15.1307 16.8384 14.9198 16.7966 14.7229 16.7151C14.526 16.6335 14.3469 16.5138 14.1958 16.3625L14.1458 16.3125C13.9495 16.1219 13.7003 15.9924 13.4298 15.943C13.1593 15.8936 12.8805 15.9265 12.6292 16.0375C12.3827 16.1438 12.1714 16.3195 12.0205 16.5436C11.8696 16.7677 11.7855 17.0308 11.7792 17.3V17.5C11.7792 17.9311 11.608 18.3446 11.3048 18.6479C11.0015 18.9512 10.588 19.1223 10.1569 19.1223C9.72578 19.1223 9.31232 18.9512 9.00905 18.6479C8.70578 18.3446 8.53458 17.9311 8.53458 17.5V17.425C8.52366 17.1476 8.43026 16.8799 8.26575 16.6568C8.10124 16.4337 7.87301 16.2654 7.61125 16.1708C7.35995 16.0598 7.08117 16.027 6.81067 16.0764C6.54017 16.1258 6.29101 16.2553 6.09458 16.4458L6.04458 16.4958C5.89352 16.6471 5.7144 16.7668 5.51751 16.8484C5.32061 16.9299 5.10969 16.9717 4.89667 16.9717C4.68364 16.9717 4.47272 16.9299 4.27583 16.8484C4.07893 16.7668 3.89981 16.6471 3.74875 16.4958C3.59745 16.3448 3.47776 16.1657 3.39621 15.9688C3.31465 15.7719 3.27283 15.561 3.27283 15.3479C3.27283 15.1349 3.31465 14.924 3.39621 14.7271C3.47776 14.5302 3.59745 14.3511 3.74875 14.2V14.15C3.93929 13.9537 4.06878 13.7045 4.11817 13.434C4.16756 13.1635 4.13471 12.8847 4.02375 12.6333C3.91741 12.3869 3.74171 12.1756 3.51764 12.0247C3.29357 11.8738 3.03043 11.7896 2.76125 11.7833H2.53458C2.10349 11.7833 1.69003 11.6121 1.38676 11.3089C1.08349 11.0056 0.912292 10.5921 0.912292 10.161C0.912292 9.72991 1.08349 9.31645 1.38676 9.01318C1.69003 8.70991 2.10349 8.53871 2.53458 8.53871H2.60958C2.88699 8.52779 3.15467 8.43439 3.37777 8.26988C3.60087 8.10537 3.76918 7.87714 3.86375 7.61538C3.97471 7.36408 4.00756 7.0853 3.95817 6.8148C3.90878 6.5443 3.77929 6.29514 3.58875 6.09871L3.53875 6.04871C3.38745 5.89765 3.26776 5.71853 3.18621 5.52163C3.10465 5.32474 3.06283 5.11382 3.06283 4.90079C3.06283 4.68777 3.10465 4.47685 3.18621 4.27996C3.26776 4.08306 3.38745 3.90394 3.53875 3.75288C3.68981 3.60158 3.86893 3.48189 4.06583 3.40033C4.26272 3.31878 4.47364 3.27696 4.68667 3.27696C4.89969 3.27696 5.11061 3.31878 5.30751 3.40033C5.5044 3.48189 5.68352 3.60158 5.83458 3.75288L5.88458 3.80288C6.08101 3.99341 6.33017 4.12291 6.60067 4.1723C6.87117 4.22169 7.14995 4.18884 7.40125 4.07788H7.47625C7.72267 3.97154 7.93397 3.79584 8.0849 3.57177C8.23582 3.3477 8.31998 3.08456 8.32625 2.81538V2.58871C8.32625 2.15762 8.49745 1.74416 8.80072 1.44089C9.10399 1.13762 9.51745 0.966423 9.94854 0.966423C10.3796 0.966423 10.7931 1.13762 11.0964 1.44089C11.3996 1.74416 11.5708 2.15762 11.5708 2.58871V2.66371C11.5771 2.93289 11.6612 3.19603 11.8122 3.4201C11.9631 3.64417 12.1744 3.81987 12.4208 3.92621C12.6721 4.03717 12.9509 4.07002 13.2214 4.02063C13.4919 3.97124 13.7411 3.84175 13.9375 3.65121L13.9875 3.60121C14.1386 3.44991 14.3177 3.33022 14.5146 3.24867C14.7115 3.16711 14.9224 3.12529 15.1354 3.12529C15.3484 3.12529 15.5594 3.16711 15.7563 3.24867C15.9531 3.33022 16.1323 3.44991 16.2833 3.60121C16.4346 3.75227 16.5543 3.93139 16.6359 4.12829C16.7174 4.32518 16.7592 4.5361 16.7592 4.74913C16.7592 4.96215 16.7174 5.17307 16.6359 5.36997C16.5543 5.56686 16.4346 5.74598 16.2833 5.89704L16.2333 5.94704C16.0428 6.14347 15.9133 6.39263 15.8639 6.66313C15.8145 6.93363 15.8473 7.21241 15.9583 7.46371V7.53871C16.0647 7.78513 16.2404 7.99643 16.4644 8.14736C16.6885 8.29828 16.9516 8.38244 17.2208 8.38871H17.4475C17.8786 8.38871 18.292 8.55991 18.5953 8.86318C18.8986 9.16645 19.0698 9.57991 19.0698 10.011C19.0698 10.4421 18.8986 10.8555 18.5953 11.1588C18.292 11.4621 17.8786 11.6333 17.4475 11.6333H17.3725C17.1033 11.6395 16.8402 11.7237 16.6161 11.8746C16.392 12.0255 16.2163 12.2368 16.11 12.4833V12.5Z"
                    stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
        </button>
    </section>
    <div class="status-item">
        <span class="status-label">Status:</span>
        <span id="sessionStatus" class="status-value status-created">Created</span>
    </div>
    <div class="status-item">
        <span class="status-label">Iteration:</span>
        <span id="iterationCount" class="status-value">0 / 8</span>
    </div>
    <div class="status-item">
        <span class="status-label">Session:</span>
        <span id="sessionId" class="status-value">-</span>
    </div>
    <button id="btnViewInteractions" class="btn btn-secondary btn-small">üìú View Agent Interactions</button>
</section>
<br />
<!-- Final Output Panel -->
<section class="output-panel collapsible-section" id="finalOutputSection">
    <div class="collapsible-header" onclick="toggleSection('finalOutputSection')">
        <div style="display: flex; align-items: center; gap: 0.5rem;">
            <h2>üìú The Council's recommendation</h2>
        </div>
        <div class="collapsible-chevron">
            <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M3 4.5L6 7.5L9 4.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
        </div>
    </div>
    <div class="collapsible-content">
        <div style="padding: 1rem 1.5rem 0; display: flex; justify-content: flex-end;">
            <div class="output-controls">
                <button id="btnIterateWithFeedback" class="btn btn-small btn-primary" style="display: none;">Iterate with Feedback</button>
                <button id="btnCopyOutput" class="btn btn-small btn-secondary">üìã Copy</button>
                <button id="btnDownloadOutput" class="btn btn-small btn-secondary" disabled>‚¨á Download Output</button>
            </div>
        </div>
        <div class="output-content">
             <!-- Rendered Markdown Container -->
            <div id="finalOutputContainer" class="markdown-body" style="min-height: 200px; line-height: 1.6;">
                <p class="text-muted" style="font-style: italic; color: var(--text-tertiary);">Final output will appear here when the Creator finalizes the content or the session is stopped...</p>
            </div>
            <!-- Hidden Raw Output for JS Logic -->
            <textarea id="finalOutput" style="display: none;"></textarea>
        </div>
    </div>
</section>
<br />
<!-- Feedback History Panel -->
<section class="feedback-history-panel collapsible-section collapsed" id="feedbackHistorySection">
    <div class="collapsible-header" onclick="toggleSection('feedbackHistorySection')">
        <h3>üìã Feedback History</h3>
        <div class="collapsible-chevron">
            <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M3 4.5L6 7.5L9 4.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                    stroke-linejoin="round" />
            </svg>
        </div>
    </div>
    <div class="collapsible-content">
        <div id="feedbackRoundsList" class="feedback-rounds-list" style="padding: 1em;">
            <div class="empty-state">
                <p>No feedback rounds yet. Start a session to see iteration history.</p>
            </div>
        </div>
    </div>
</section>

</div>

<!-- Iterate with Feedback Modal -->
<div id="feedbackModal" class="lightbox-overlay hidden">
    <div class="lightbox-content feedback-modal-content">
        <div class="lightbox-header">
            <h2>üîÅ Iterate with Feedback</h2>
            <button class="lightbox-close" onclick="dxoApp.closeFeedbackModal()">&times;</button>
        </div>
        <div class="lightbox-body">
            <div class="feedback-modal-body">
                <!-- Context Section (Read-only) -->
                <div class="feedback-context-section">
                    <h3>Context</h3>
                    <div class="context-item">
                        <label>Original Topic:</label>
                        <div id="feedbackContextTopic" class="context-display"></div>
                    </div>
                    <div class="context-item">
                        <label id="feedbackContextOutputLabel">Current Final Output (v1):</label>
                        <div id="feedbackContextOutput" class="context-display output-preview"></div>
                    </div>
                </div>

                <!-- User Feedback Section -->
                <div class="feedback-input-section">
                    <h3>Your Feedback</h3>
                    <label for="feedbackComments" class="required-label">What should change? <span class="required-asterisk">*</span></label>
                    <textarea id="feedbackComments" rows="6" 
                        placeholder="Describe what you'd like the Council to revise in the output. Be specific about what needs to change."></textarea>
                    
                    <!-- Optional Constraints -->
                    <div class="feedback-constraints collapsible-section collapsed" id="feedbackConstraintsSection">
                        <div class="collapsible-header" onclick="toggleSection('feedbackConstraintsSection')">
                            <h4>Optional Constraints</h4>
                            <div class="collapsible-chevron">
                                <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M3 4.5L6 7.5L9 4.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                                </svg>
                            </div>
                        </div>
                        <div class="collapsible-content">
                            <div class="constraints-grid" style="padding-top: 1rem;">
                                <div class="constraint-group">
                                    <label for="feedbackTone">Tone:</label>
                                    <select id="feedbackTone" class="form-control">
                                        <option value="">Same</option>
                                        <option value="more-executive">More Executive</option>
                                        <option value="more-technical">More Technical</option>
                                        <option value="more-casual">More Casual</option>
                                        <option value="more-formal">More Formal</option>
                                    </select>
                                </div>
                                <div class="constraint-group">
                                    <label for="feedbackLength">Length:</label>
                                    <select id="feedbackLength" class="form-control">
                                        <option value="">Same</option>
                                        <option value="shorter">Shorter</option>
                                        <option value="expand">Expand</option>
                                    </select>
                                </div>
                                <div class="constraint-group">
                                    <label for="feedbackAudience">Audience:</label>
                                    <select id="feedbackAudience" class="form-control">
                                        <option value="">Same</option>
                                        <option value="leadership">Leadership</option>
                                        <option value="engineers">Engineers</option>
                                        <option value="general">General</option>
                                        <option value="experts">Domain Experts</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Iteration Controls -->
                    <div class="feedback-iteration-controls">
                        <div class="constraint-group">
                            <label for="feedbackMaxIterations">Max Additional Iterations:</label>
                            <input type="number" id="feedbackMaxIterations" value="1" min="1" max="3" class="form-control" />
                            <small class="form-text">Number of additional iterations to allow (1-3)</small>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <br />
                <div class="feedback-modal-actions">
                    <button id="btnSubmitFeedback" class="btn btn-primary">Re-run</button>
                    @* <button id="btnCancelFeedback" class="btn btn-secondary" onclick="dxoApp.closeFeedbackModal()">Cancel</button> *@
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Session Settings Flyout -->
<div id="sessionSettingsFlyout" class="flyout-overlay hidden">
    <div class="flyout-panel">
        <div class="flyout-header">
            <h3>Session Settings</h3>
            <button class="flyout-close" onclick="dxoApp.closeSessionSettings()">&times;</button>
        </div>
        <div class="flyout-body">
            <div class="flyout-setting-group">
                <label for="sessionName">Session Name</label>
                <input type="text" id="sessionName" value="New Session" maxlength="200" class="form-control" />
            </div>

            <div class="flyout-setting-group">
                <label for="maxIterations">Max Iterations</label>
                <input type="number" id="maxIterations" value="8" min="1" max="50" class="form-control" />
                <small class="form-text">Maximum number of iteration cycles to run</small>
            </div>

            <div class="flyout-setting-group">
                <label for="stopMarker">Stop Marker</label>
                <input type="text" id="stopMarker" value="FINAL:" maxlength="50" class="form-control" />
                <small class="form-text">Text marker that signals completion</small>
            </div>

            <div class="flyout-setting-group">
                <label for="runMode">Run Mode</label>
                <select id="runMode" class="form-control">
                    <option value="Auto">Auto - Run continuously</option>
                    <option value="Step">Step - Manual iteration control</option>
                </select>
            </div>

            <div class="flyout-setting-group">
                <label class="checkbox-label">
                    <input type="checkbox" id="stopOnApproved" checked />
                    Stop when all reviewers sign off
                </label>
                <small class="form-text">Automatically stop when all reviewers approve</small>
            </div>

            <div class="flyout-actions">
                <button id="btnReset" class="btn btn-warning">üîÑ Reset Session</button>
                <button id="btnExport" class="btn btn-info">üì§ Export Transcript</button>
            </div>
        </div>
    </div>
</div>

<!-- Interaction Stream Lightbox -->
<div id="interactionStreamLightbox" class="lightbox-overlay hidden">
    <div class="lightbox-content">
        <div class="lightbox-header">
            <h2>üìú Agent Interactions</h2>
            <div class="lightbox-header-controls">
                <label class="checkbox-label">
                    <input type="checkbox" id="autoScroll" checked />
                    Auto-scroll
                </label>
                <button id="btnClearTrace" class="btn btn-small btn-secondary">Clear</button>
                <button class="lightbox-close" onclick="dxoApp.closeInteractionStream()">&times;</button>
            </div>
        </div>
        <div class="lightbox-body">
            <div id="traceViewer" class="trace-content">
                <div class="empty-state">
                    <p>No messages yet. Configure your topic and click Start to begin.</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Export Modal -->
<div id="exportModal" class="modal hidden">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="exportModalTitle">Export</h3>
            <button class="modal-close" onclick="dxoApp.closeExportModal()">&times;</button>
        </div>
        <div class="modal-body">
            <button id="btnExportOption1" class="btn btn-primary">Download as JSON</button>
            <button id="btnExportOption2" class="btn btn-primary">Download as TXT</button>
        </div>
    </div>
</div>

<!-- Full Draft Modal -->
<div id="fullDraftModal" class="lightbox-overlay hidden">
    <div class="lightbox-content">
        <div class="lightbox-header">
            <h2 id="draftModalTitle">Iteration Draft</h2>
            <button class="lightbox-close" onclick="dxoApp.closeDraftModal()">&times;</button>
        </div>
        <div class="lightbox-body">
            <div id="draftModalContent" class="draft-modal-content"></div>
        </div>
    </div>
</div>

<!-- Reviewer Selection Flyout -->
<div id="reviewerSelectionFlyout" class="flyout-overlay hidden">
    <div class="flyout-panel">
        <div class="flyout-header">
            <h3>Select a Reviewer Template</h3>
            <button class="flyout-close" onclick="dxoApp.closeReviewerSelector()">&times;</button>
        </div>
        <div class="flyout-body">
            <p class="flyout-hint">Choose a reviewer agent template to add to your council:</p>
            <div id="reviewerTemplatesGrid" class="reviewer-templates-grid">
                <!-- Reviewer template cards will be dynamically loaded here -->
            </div>
        </div>
    </div>
</div>

<!-- Reviewer Card Template (Hidden) -->
<template id="reviewerCardTemplate">
    <div class="persona-card reviewer collapsed" data-agent-type="reviewer" data-reviewer-id="">
        <div class="card-header" onclick="togglePersonaCard(this)">
            <div class="reviewer-name-container">
                <span class="reviewer-icon">üîç</span>
                <input type="text" class="reviewer-name-input" value="Reviewer" maxlength="50"
                    placeholder="Reviewer name" onclick="event.stopPropagation()" />
            </div>
            <div class="card-header-actions">
                <select class="reviewer-model model-select-header" onclick="event.stopPropagation()"></select>
                <button class="btn btn-small btn-danger btn-delete-reviewer" title="Delete Reviewer"
                    onclick="event.stopPropagation()">üóëÔ∏è</button>
                <button class="btn btn-small btn-secondary btn-reset-reviewer" onclick="event.stopPropagation()">Reset
                    Memory</button>
                <div class="collapsible-chevron">
                    <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M3 4.5L6 7.5L9 4.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                            stroke-linejoin="round" />
                    </svg>
                </div>
            </div>
        </div>

        <div class="card-body">
            <details class="seed-prompt-section">
                <summary>Prompt</summary>
                <textarea class="reviewer-prompt" rows="6" placeholder="Enter Reviewer seed prompt..."></textarea>
            </details>

            <details class="advanced-settings">
                <summary>Advanced Settings</summary>
                <div class="settings-grid">
                    <div class="setting-group">
                        <label>Temperature</label>
                        <input type="number" class="reviewer-temp" value="0.5" min="0" max="2" step="0.1" />
                    </div>
                    <div class="setting-group">
                        <label>Max Tokens</label>
                        <input type="number" class="reviewer-max-tokens" value="4096" min="1" max="128000" />
                    </div>
                    <div class="setting-group">
                        <label>Top P</label>
                        <input type="number" class="reviewer-top-p" value="1.0" min="0" max="1" step="0.1" />
                    </div>
                    <div class="setting-group">
                        <label>Presence Penalty</label>
                        <input type="number" class="reviewer-presence-penalty" value="0" min="-2" max="2" step="0.1" />
                    </div>
                    <div class="setting-group">
                        <label>Frequency Penalty</label>
                        <input type="number" class="reviewer-frequency-penalty" value="0" min="-2" max="2" step="0.1" />
                    </div>
                </div>
            </details>
        </div>
    </div>
    </div>
</template>

@section Scripts {
    <script src="~/js/dxo.js" asp-append-version="true"></script>
    <script>
        // Toggle collapsible sections
        function toggleSection(sectionId) {
            const section = document.getElementById(sectionId);
            if (section) {
                section.classList.toggle('collapsed');
            }
        }

        // Toggle persona card collapse/expand
        function togglePersonaCard(headerElement) {
            const card = headerElement.closest('.persona-card');
            if (card) {
                card.classList.toggle('collapsed');
            }
        }
    </script>
}

<style>
    /* Auto-expand trace viewer to fit content */
    #traceViewer.trace-content {
        overflow: visible !important;
        height: auto !important;
        max-height: none !important;
        min-height: 3rem;
        padding-bottom: 0.5rem;
    }
</style>